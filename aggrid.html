<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>File Upload Form</title>
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- Ag-Grid CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/ag-grid-community/styles/ag-grid.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/ag-grid-community/styles/ag-theme-alpine.css"
    />

    <!-- Ag-Grid JavaScript -->
    <script src="https://unpkg.com/ag-grid-community/dist/ag-grid-community.min.noStyle.js"></script>

    <style>
      body {
        padding: 20px;
      }

      .file-upload {
        margin-top: 20px;
      }

      .errorstooltips {
        display: none;
        color: red;
        font-weight: bold;
      }

      .NoteContent {
        font-weight: bold;
        display: none;
      }

      .dataBox {
        border: 0px none;
      }

      #content-table {
        display: none;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="row justify-content-md-center">
        <div class="col-md-6">
          <h2 class="text-center">File Upload Form</h2>
          <form
            action="#"
            method="post"
            enctype="multipart/form-data"
            class="file-upload"
          >
            <div class="form-group">
              <label for="fileInput">Choose File:</label>
              <input
                type="file"
                id="fileInput"
                name="fileInput"
                accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"
              />
            </div>
            <button type="submit" id="getJson" class="btn btn-primary">
              getJson
            </button>
          </form>
          <div class="errorstooltips">Erros or toolTips</div>
        </div>
      </div>

      <p class="NoteContent">content Here Note*</p>

      <div id="myGrid" style="height: 500px" class="ag-theme-alpine"></div>
    </div>

    <script>
      //excel Data
      var worksheetData = [];
      var gridOptions;

      //counter
      var dataCounter = 0;

      // Initialize Ag-Grid

      $(document).ready(function () {});

      document.addEventListener("DOMContentLoaded", function () {
        gridOptions = {
          columnDefs: [
            { headerName: "First name", field: "First_Name", editable: true },
            { headerName: "Last name", field: "Last_Name", editable: true },
            {
              headerName: "Age",
              field: "Age",
              editable: true,
              cellEditor: "agNumericCellEditor",
            },
            { headerName: "Email", field: "email", editable: true },
            { headerName: "City", field: "city", editable: true },
            { headerName: "Address 1", field: "address_1", editable: true },
            { headerName: "Address 2", field: "address_2", editable: true },
            { headerName: "State", field: "state", editable: true },
            { headerName: "Pincode", field: "pincode", editable: true },
            { headerName: "Comments", field: "comments", editable: true },
          ],
          defaultColDef: {
            editable: true,
          },
          onCellValueChanged: validateChecker,
        };

        var gridDiv = document.querySelector("#myGrid");
        new agGrid.Grid(gridDiv, gridOptions);

        document
          .getElementById("fileInput")
          .addEventListener("change", function () {
            var reader = new FileReader();
            reader.onload = function () {
              var arrayBuffer = this.result,
                array = new Uint8Array(arrayBuffer),
                binaryString = String.fromCharCode.apply(null, array);
              var workbook = XLSX.read(binaryString, {
                type: "binary",
              });

              var first_sheet_name = workbook.SheetNames[0];
              var worksheet = workbook.Sheets[first_sheet_name];
              var worksheetData = XLSX.utils.sheet_to_json(worksheet, {
                raw: true,
              });

              gridOptions.api.setRowData(worksheetData);
            };
            reader.readAsArrayBuffer(this.files[0]);
          });
        function validateChecker() {
          gridOptions.api.forEachNode(function (node) {
            // Access the row data for each node
            var rowData = node.data;
            var firstName = rowData.First_Name;
            var lastName = rowData.Last_Name;
            var age = rowData.Age;
            var email = rowData.email;
            var city = rowData.city;
            var state = rowData.state;
            var pincode = rowData.pincode;

            // Validate empty values
            // Validate empty values
            if (!validateEmpty(firstName)) {
              setCellError(node, "First_Name");
            } else {
              clearCellError(node, "First_Name");
            }
            validateEmpty(lastName);
            validateEmpty(age);
            validateEmpty(email);
            validateEmpty(city);
            validateEmpty(state);
            validateEmpty(pincode);

            // Validate not contain numbers
            validateNotContainsNumberOrSpecialSymbol(firstName);
            validateNotContainsNumberOrSpecialSymbol(lastName);
            validateNotContainsNumberOrSpecialSymbol(city);
            validateNotContainsNumberOrSpecialSymbol(state);

            // Validate only contains numbers
            validateOnlyNumbersAndNoSpecialSymbol(age);
            validateOnlyNumbersAndNoSpecialSymbol(pincode);

            // Validate email format
            validateEmail(email);
          });
        }
      });

      document.getElementById("getJson").addEventListener("click", function () {
        event.preventDefault();

        if (gridOptions.api) {
          // Get the row data from the Ag-Grid
          var rowData = [];
          gridOptions.api.forEachNode(function (node) {
            rowData.push(node.data);
          });

          // Log the JSON data to the console (you can modify this part as needed)
          console.log("JSON Data:", JSON.stringify(rowData, null, 2));
        } else {
          console.error("gridOptions.api is not defined.");
        }
      });
    </script>
  </body>
</html>
